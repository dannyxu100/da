/**daGif
*逐帧动画类
* @author danny.xu
* @version daGif_1.0 2011-10-28 22:32:25
*/
(function(j,k){var l=j.document;if(!document.defaultView||!document.defaultView.getComputedStyle){var m=da.curCSS;da.curCSS=function(a,b,c){if(b==='background-position'){b='backgroundPosition'}if(b!=='backgroundPosition'||!a.currentStyle||a.currentStyle[b]){return m.apply(this,arguments)}var d=a.style;if(!c&&d&&d[b]){return d[b]}return m(a,'backgroundPositionX',c)+' '+m(a,'backgroundPositionY',c)}}var n=da.fnStruct.act;da.fnStruct.act=function(a){if('background-position'in a){a.backgroundPosition=a['background-position'];delete a['background-position']}if('backgroundPosition'in a){a.backgroundPosition='('+a.backgroundPosition}return n.apply(this,arguments)};function _BgPositionToArray(a){a=a.replace(/left|top/g,'0px');a=a.replace(/right|bottom/g,'100%');a=a.replace(/([0-9\.]+)(\s|\)|$)/g,"$1px$2");var b=a.match(/(-?[0-9\.]+)(px|\%|em|pt)\s(-?[0-9\.]+)(px|\%|em|pt)/);return[parseFloat(b[1],10),b[2],parseFloat(b[3],10),b[4]]}daFx.step.backgroundPosition=function(a){if(!a.bgPosReady){var b=da.curCSS(a.elem,'backgroundPosition');if(!b){b='0px 0px'}b=_BgPositionToArray(b);a.start=[b[0],b[2]];var c=_BgPositionToArray(a.end);a.end=[c[0],c[2]];a.unit=[c[1],c[3]];a.bgPosReady=true}var d=[];d[0]=((a.end[0]-a.start[0])*a.pos)+a.start[0];d[1]=((a.end[1]-a.start[1])*a.pos)+a.start[1];a.elem.style.backgroundPosition=d[0]+a.unit[0]+' '+d[1]+a.unit[1]};daFx.easing['daGif']=function(x,t,b,c,d){};var o=(function(){var i=function(a){return new i.fnStruct.init(a)};i.fnStruct=i.prototype={version:"daGif v1.0 \nauthor: danny.xu \ndate: 2011-10-28 22:32:28",daObj:null,gifTime:0,gifNowStep:0,gifNowTime:0,isStop:true,gifSetting:{target:null,src:"",width:0,height:0,top:"0px",all:0,first:1,speed:25,isAuto:true,isBack:false,isLoop:false},init:function(a){a=this.gifSetting=da.extend({},this.gifSetting,a);if(!a.all){alert("daGif温馨提示：您未传入动画总帧数。");return false}this.daObj=da(a.target);if(0>=this.daObj.dom.length){alert("daGif温馨提示：没有找到您需要播放逐帧动画的对象。");return false}if(a.src){this.daObj.dom[0].style.backgroundImage="url("+a.src+")";this.daObj.dom[0].style.backgroundRepeat="no-repeat"}else if(""===this.daObj.css("backgroundImage")){alert("daGif温馨提示：您传入的动画图片地址有误。");return false}this.daObj.dom[0].style.width=a.width+"px";this.daObj.dom[0].style.height=a.height+"px";this.setSpeed();if(a.isAuto)this.replay();else this.isStop=true},play:function(e){if(!this.isStop)return;this.isStop=false;var f=this.gifSetting,fromLeft=0,toLeft=-(f.all-1)*f.width,nTime;if(e||0===this.gifTime){this.daObj.stop();nTime=this.gifTime;if(f.isBack){var g=fromLeft;fromLeft=toLeft;toLeft=g}}else{fromLeft=this.gifNowStep*f.width;nTime=this.gifTime-this.gifNowTime;if(f.isBack){toLeft=0}}this.daObj.dom[0].style.backgroundPosition=fromLeft+"px "+f.top;var h=this;this.daObj.act({backgroundPosition:(toLeft+"px "+f.top)},{duration:nTime,step:function(a,b){},update:function(a){if(!a.bgPosReady){var b=da.curCSS(a.elem,'backgroundPosition');if(!b){b='0px 0px'}b=_BgPositionToArray(b);a.start=[b[0],b[2]];var c=_BgPositionToArray(a.end);a.end=[c[0],c[2]];a.unit=[c[1],c[3]];a.bgPosReady=true}var d=[];d[0]=((a.end[0]-a.start[0])*a.pos)+a.start[0];d[1]=((a.end[1]-a.start[1])*a.pos)+a.start[1];h.gifNowTime=h.gifTime*a.pos;h.gifNowStep=parseInt(d[0]/f.width);d[0]=h.gifNowStep*f.width;a.elem.style.backgroundPosition=d[0]+a.unit[0]+' '+d[1]+a.unit[1]},complete:function(){h.isStop=true;h.gifNowTime=0;if(f.isBack)h.gifNowStep=-f.all;else h.gifNowStep=0;if(f.isLoop)h.play()}})},replay:function(){this.isStop=true;this.play(true)},stop:function(a,b){this.daObj.stop(a,b);this.isStop=true},backplay:function(a){this.gifSetting.isBack=a||!this.gifSetting.isBack;this.play(true)},go:function(a){var b=this.gifSetting;this.stop();this.gifNowStep=-a||0;this.daObj.dom[0].style.backgroundPosition=(this.gifNowStep*b.width)+"px "+b.top},setSpeed:function(a){a=a||this.gifSetting.speed;this.tOneStep=1000/a;this.gifTime=this.gifSetting.all*this.tOneStep;if(!this.isStop)this.replay()}};i.fnStruct.init.prototype=i.prototype;return i})();j.daGif=o})(window);