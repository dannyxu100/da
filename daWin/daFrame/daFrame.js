/**daFrame
*容器类
* @author danny.xu
* @version daFrame_1.0 2011/7/10 11:55:21
*/

(function(k,l){var m=k.document;var n=(function(){var j=function(a){return new j.fnStruct.init(a)};j.fnStruct=j.prototype={version:"daFrame v1.0 \n author: danny.xu \n date: 2011/7/10 11:55:57",cntId:0,cntObj:null,cntParentObj:null,cntMainObj:null,cntBoxObj:null,cntOverObj:null,cntScrollV:null,cntScrollH:null,cntSize:null,cntBoxSize:null,cntScale:null,cntIframeObj:null,cntImageObj:null,cntCorner:16,isLocal:true,cntLoadingObj:null,cntSetting:{window:k,parent:null,width:0,height:0,css:{cnt:"daCnt",main:"daCntMain",box:"daCntBox",over:"daCntOver",sclV:"scl_v",sclH:"scl_h",sclV2:"scl_v2",sclH2:"scl_h2"},border:"1px solid #666",html:"",url:"",src:"",load:null,unload:null,back:null,close:null},init:function(a){a=this.cntSetting=da.extend(true,{},this.cntSetting,a);k=a.window;m=k.document;this.cntParentObj=da(a.parent);if(0>=this.cntParentObj.length){alert("daFrame温馨提示: 需要指定父亲DOM对象");return}this.cntParentObj=this.cntParentObj.dom[0];while(m.getElementById("daCnt"+this.cntId)){this.cntId++};this.cntId="daCnt"+this.cntId;this.cntSize={w:0,h:0};this.cntBoxSize={w:0,h:0};this.cntScale={w:1,h:1};this.create();this.setCnt();this.setSize();this.bindEvent();if(""!=this.cntSetting.url||""!=this.cntSetting.src)this.loading()},create:function(){var a=m.createElement("div"),mainObj=m.createElement("div"),overObj=m.createElement("div"),boxObj=m.createElement("div"),scrollVObj=m.createElement("a"),scrollHObj=m.createElement("a");a.id=this.cntId;a.className=this.cntSetting.css.cnt;a.style.border=this.cntSetting.border;boxObj.id=this.cntId+"_box";boxObj.className=this.cntSetting.css.box;mainObj.insertBefore(boxObj,null);overObj.id=this.cntId+"_over";overObj.className=this.cntSetting.css.over;mainObj.insertBefore(overObj,null);mainObj.id=this.cntId+"_main";mainObj.className=this.cntSetting.css.main;a.insertBefore(mainObj,null);scrollVObj.id=this.cntId+"_scrollV";scrollVObj.className=this.cntSetting.css.sclV;scrollVObj.href="javascript:void(0);";a.insertBefore(scrollVObj,null);scrollHObj.id=this.cntId+"_scrollH";scrollHObj.className=this.cntSetting.css.sclH;scrollHObj.href="javascript:void(0);";a.insertBefore(scrollHObj,null);this.cntParentObj.insertBefore(a,null);this.cntObj=a;this.cntMainObj=mainObj;this.cntBoxObj=boxObj;this.cntOverObj=overObj;this.cntScrollV=scrollVObj;this.cntScrollH=scrollHObj},bindEvent:function(){var i=this;daDrag({window:k,src:this.cntScrollV,target:this.cntScrollV,cursor:"pointer",before:function(a,b,c){b.className=i.cntSetting.css.sclV2},move:function(a,b,c,d,e,f,g){var h=1,maxY=da(i.cntMainObj).height()-da(i.cntScrollV).height()-i.cntCorner;e.y=(e.y>maxY)?maxY:e.y;e.y=(e.y<h)?h:e.y;i.cntBoxObj.style.top=-(e.y/i.cntScale.h)+"px";return{x:"auto",y:e.y}},after:function(a,b,c){b.className=i.cntSetting.css.sclV}});daDrag({window:k,src:this.cntScrollH,target:this.cntScrollH,cursor:"pointer",before:function(a,b,c){b.className=i.cntSetting.css.sclH2},move:function(a,b,c,d,e,f,g){var h=1,maxX=da(i.cntMainObj).width()-da(i.cntScrollH).width()-i.cntCorner;e.x=(e.x>maxX)?maxX:e.x;e.x=(e.x<h)?h:e.x;i.cntBoxObj.style.left=-(e.x/i.cntScale.w)+"px";return{x:e.x,y:"auto"}},after:function(a,b,c){b.className=i.cntSetting.css.sclH}});this.bindWheel(this.cntOverObj)},bindWheel:function(a){var b=this,nWheelDeltaStep=30,maxY,nTop;daWheel({target:a,before:function(){maxY=da(b.cntBoxObj).height()-da(b.cntMainObj).height()-4,nTop=b.cntBoxObj.offsetTop},up:function(){nTop=nTop+nWheelDeltaStep},down:function(){nTop=nTop-nWheelDeltaStep},after:function(){nTop=(0<nTop)?0:(-maxY>nTop)?-maxY:nTop;b.cntBoxObj.style.top=nTop+"px";b.cntScrollV.style.top=-(nTop*b.cntScale.h)+"px"}})},setCnt:function(){if(""!=this.cntSetting.html){this.cntBoxObj.innerHTML=this.cntSetting.html}else if(""!=this.cntSetting.url){this.cntIframeObj=this.iframe();this.cntBoxObj.insertBefore(this.cntIframeObj,null)}else if(""!=this.cntSetting.src){this.cntImageObj=this.image();this.cntBoxObj.insertBefore(this.cntImageObj,null)}},image:function(){var a=this;imageObj=m.createElement("img");imageObj.src=this.cntSetting.src;da.loadImage(this.cntSetting.src,function(){a.setSize();a.loading(true)});return imageObj},iframe:function(){var c=this;iframeObj=m.createElement("iframe");iframeObj.scrolling="no";iframeObj.frameBorder="0";iframeObj.src=this.cntSetting.url;iframeObj.onreadystatechange=function(){if("complete"!==this.readyState)return;if("unknown"!=typeof this.contentWindow.document){var a=Math.max(c.cntSetting.width,this.contentWindow.document.body.offsetWidth);var b=Math.max(c.cntSetting.height,this.contentWindow.document.body.offsetHeight);da(this).width(a);da(this).height(b);a=Math.max(c.cntSetting.width,this.contentWindow.document.body.offsetWidth);b=Math.max(c.cntSetting.height,this.contentWindow.document.body.offsetHeight);da(this).width(a);da(this).height(b);c.contentSize={w:a,h:b};c.setSize();c.loading(true);if(c.cntSetting.load)c.cntSetting.load.call(this.contentWindow,c);if(c.cntSetting.back){this.contentWindow.dialogreturn=this.contentWindow.back=function(){c.cntSetting.back.apply(this.contentWindow,arguments)};this.contentWindow.myclosewin=this.contentWindow.close=function(){c.cntSetting.close.apply(this.contentWindow,arguments)}}da(this.contentWindow).bind("unload",function(){c.cntSetting.unload.apply(this,arguments)});c.bindWheel(this.contentWindow.document.body)}else{this.parentNode.replaceChild(d(),this)}};iframeObj.onload=function(){if(this.contentWindow.document){var a=Math.max(c.cntSetting.width,this.contentWindow.document.body.offsetWidth);var b=Math.max(c.cntSetting.height,this.contentWindow.document.body.offsetHeight);da(this).width(a);da(this).height(b);a=Math.max(c.cntSetting.width,this.contentWindow.document.body.offsetWidth);b=Math.max(c.cntSetting.height,this.contentWindow.document.body.offsetHeight);da(this).width(a);da(this).height(b);c.contentSize={w:a,h:b};c.setSize();c.loading(true);if(c.cntSetting.load)c.cntSetting.load.call(this.contentWindow,c);if(c.cntSetting.back){this.contentWindow.dialogreturn=this.contentWindow.back=function(){c.cntSetting.back.apply(this.contentWindow,arguments)};this.contentWindow.myclosewin=this.contentWindow.close=function(){c.cntSetting.close.apply(this.contentWindow,arguments)}}da(this.contentWindow).bind("unload",function(){c.cntSetting.unload.apply(this.contentWindow,arguments)});c.bindWheel(this.contentWindow.document.body)}else{this.parentNode.replaceChild(d(),this)}};var d=function(){var a=m.createElement("iframe");a.scrolling="auto";a.frameBorder="0";a.src=c.cntSetting.url;da(a).width(da(c.cntObj).width());da(a).height(da(c.cntObj).height());a.onreadystatechange=function(){if("complete"==this.readyState){c.loading(true);if(c.cntSetting.load)c.cntSetting.load.call(c)}};a.onload=function(){c.loading(true);if(c.cntSetting.load)c.cntSetting.load.call(c)};c.cntIframeObj=a;c.isLocal=false;return a};return iframeObj},refresh:function(){this.loading();if(""!=this.cntSetting.url)this.cntIframeObj.src=this.cntSetting.url;else if(""!=this.cntSetting.src)this.cntImageObj.src=this.cntSetting.src},scrollBar:function(){if(this.isLocal){if(this.cntBoxSize.w>this.cntSize.w+2)this.cntScrollH.style.display="block";else this.cntScrollH.style.display="none";if(this.cntBoxSize.h>this.cntSize.h+2)this.cntScrollV.style.display="block";else this.cntScrollV.style.display="none"}else this.cntScrollV.style.display=this.cntScrollH.style.display="none"},setSize:function(a,b){var c=da(this.cntParentObj),da_boxObj=da(this.cntBoxObj),wBox=da_boxObj.width(),hBox=da_boxObj.height(),wCnt=(0<=a)?a:this.cntSetting.width||c.width(),hCnt=(0<=b)?b:this.cntSetting.height||c.height();da(this.cntObj).width(wCnt);da(this.cntObj).height(hCnt);da(this.cntMainObj).width(wCnt);da(this.cntMainObj).height(hCnt);da(this.cntOverObj).width(wCnt);da(this.cntOverObj).height(hCnt);if(null!=this.contentSize){if(this.contentSize.w<wCnt){da(this.cntIframeObj).width(wCnt)}if(this.contentSize.h<hCnt){da(this.cntIframeObj).height(hCnt)}}if(!this.isLocal){da(this.cntIframeObj).width(wCnt);da(this.cntIframeObj).height(hCnt)}var d=da.isNull((wCnt-this.cntCorner)/wBox,0),hScale=da.isNull((hCnt-this.cntCorner)/hBox,0);da(this.cntScrollH).width(d*wCnt);da(this.cntScrollV).height(hScale*hCnt);this.cntScale.w=d;this.cntScale.h=hScale;this.cntSize.w=this.cntSetting.width=wCnt;this.cntSize.h=this.cntSetting.height=hCnt;this.cntBoxSize.w=wBox;this.cntBoxSize.h=hBox;this.scrollBar()},loading:function(a){if(a){this.cntLoadingObj.finished();this.cntOverObj.style.display="none"}else{this.cntLoadingObj=daLoading({window:k,parent:this.cntMainObj,click:function(){this.finished()}})}}};j.fnStruct.init.prototype=j.prototype;return j})();k.daFrame=k.daFrame=k.daCnt=n})(window);