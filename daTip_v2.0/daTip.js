/*
	author:	danny.xu
	date:	2010.12.10
	description:	daTip类(信息提示框)
*/
da.extend({inPageArea:function(a,b){if(null==da.isNull(a,null))return"5";var c=da(window),winWidth=parseInt(c.width(),10)||0,winHeight=parseInt(c.height(),10)||0;var d=a.left,d_toRight=winWidth-a.left,d_toTop=a.top,d_toBottom=winHeight-a.top;var e=[];if(d_toTop>=d_toBottom)e.push("B");else e.push("T");if(d_toRight>=d)e.push("L");else e.push("R");if(undefined==b)return e.join("");if(b.height>=b.width)e.reverse();var f=5;switch(e.join("")){case"TL":f="87";break;case"LT":f="47";break;case"TR":f="89";break;case"RT":f="69";break;case"BL":f="21";break;case"LB":f="41";break;case"BR":f="23";break;case"RB":f="63";break}return f}});(function(e){var f=e.document;var g=function(a){return new g.fnStruct.init(a)};g.fnStruct=g.prototype={tipObj:null,tipId:"",tipCloseBt:null,tipTarget:null,tipParentObj:null,tipTableObj:null,tipMidObj:null,tipPointers:null,tipSetting:{title:"",html:"",target:null,color:"#f0f0f0",bg:"#d66500",onlyOne:false,group:"daTip",pointer:"87",events:null,parent:null,close:true,warn:{open:false,length:10,delay:350,show:null}},tipState:"hide",warnTimer:null,init:function(a){a=this.tipSetting=da.extend(true,{},this.tipSetting,a);var b=da(a.target),daTipObj=null;if(a.onlyOne)daTipObj=da.data(e,this.tipSetting.group);else if(0<b.dom.length)daTipObj=da.data(b.dom[0],this.tipSetting.group);if(null!=daTipObj){if(a.onlyOne){daTipObj.tipParentObj=da(a.parent).dom[0]||f.body;daTipObj.tipTarget=da(a.target).dom[0]||null;daTipObj.tipObj.style.display="block";da(daTipObj.tipObj).css({width:"100%",height:"100%"});daTipObj.tipMidObj.innerHTML=a.html||daTipObj.tipTarget.getAttribute("daTip")||"未定义提示内容。";da(daTipObj.tipObj).css({width:da(daTipObj.tipTableObj).width(),height:da(daTipObj.tipTableObj).height()})}daTipObj.show();return daTipObj}else{this.tipParentObj=da(a.parent).dom[0]||f.body;this.tipTarget=da(a.target).dom[0]||null;this.tipSetting.html=a.html||this.tipTarget.getAttribute("daTip")||"未定义提示内容。";do{this.tipId="daTip"+(new Date).getTime()}while(null!=f.getElementById(this.tipId));this.tipPointers={p8:null,p6:null,p2:null,p4:null};this.create();this.show();this.bindEvent();g.daTipCache[this.tipId]=this;da.data((a.onlyOne?e:this.tipTarget),this.tipSetting.group,this);return this}},create:function(){var a=this.tipId,tipObj=f.createElement("DIV");tipTableObj=null,isDOM=(1===this.tipSetting.html.nodeType);this.tipParentObj.insertBefore(tipObj,null);this.tipObj=tipObj;tipObj.id=a;tipObj.style.left="0px";tipObj.style.top="0px";tipObj.className="daTip";tipObj.innerHTML=['<table id="',a,'_tb" class="daTipTable" cellpadding="0" cellspacing="0">','<tr>','<td class="daTipTL"></td>','<td class="daTipT">','<div class="daTipTitle">',this.tipSetting.title,'</div>','</td>','<td class="daTipTR"></td>','</tr>','<tr>','<td class="daTipL"></td>','<td id="',a,'_mid" class="daTipMid">',(isDOM?"":this.tipSetting.html),'</td>','<td class="daTipR"></td>','</tr>','<tr>','<td class="daTipBL"></td><td class="daTipB"></td><td class="daTipBR"></td>','</tr>','</table>','<div id="',a,'_p8" class="daTipP8"></div>','<div id="',a,'_p6" class="daTipP6"></div>','<div id="',a,'_p2" class="daTipP2"></div>','<div id="',a,'_p4" class="daTipP4"></div>','<a id="',a,'_CloseBt" class="daTipCloseBt" href="javascript:void(0);" onclick=""></a>',].join("");this.tipPointers.p8=f.getElementById(a+"_p8");this.tipPointers.p6=f.getElementById(a+"_p6");this.tipPointers.p2=f.getElementById(a+"_p2");this.tipPointers.p4=f.getElementById(a+"_p4");this.tipTableObj=tipTableObj=f.getElementById(a+"_tb");this.tipCloseBt=f.getElementById(a+"_CloseBt");this.tipMidObj=f.getElementById(a+"_mid");if(isDOM)this.tipMidObj.insertBefore(this.tipSetting.html,null);this.color();var b=da(tipTableObj);da(this.tipObj).css({width:b.width(),height:b.height()})},bindEvent:function(){if(this.tipSetting.events)da.eventBind(this.tipObj,this.tipSetting.events);var a=this;da.eventBind(this.tipCloseBt,{click:function(){a.hide()}})},getPos:function(a,b){if(!a){alert("daTip温馨提示: 需要提供提示目标对象，或提示目标的位置。");return};b=b||{width:0,height:0};var c=da(this.tipObj),sizeTip={width:c.width(),height:c.height()},pNum=da.inPageArea(a,sizeTip),isNoPointer=false,pointerObj=null,tmp;if(this.tipSetting.pointer){if(null===this.tipSetting.pointer.match(/no|5/g)){pNum=this.tipSetting.pointer||pNum}else{isNoPointer=true;pNum=this.tipSetting.pointer.replace("no","")||pNum}}tmp="p"+pNum.match(/8|6|2|4/g);for(var n in this.tipPointers){if(!isNoPointer&&tmp===n)da(this.tipPointers[n]).css("display","block");else da(this.tipPointers[n]).css("display","none")}pointerObj=this.tipPointers[tmp];if(!isNoPointer)da(pointerObj).css("display","block");switch(pNum){case"8":pointerObj.style.left=(sizeTip.width/2-13)+"px";a.top+=(b.height+(!isNoPointer&&12));a.left+=(b.width/2-sizeTip.width/2);break;case"6":pointerObj.style.top=(sizeTip.height/2-15)+"px";a.top+=(b.height/2-sizeTip.height/2);a.left-=(sizeTip.width+(!isNoPointer&&12));break;case"2":pointerObj.style.left=(sizeTip.width/2-13)+"px";a.top-=(sizeTip.height+(!isNoPointer&&12));a.left+=(b.width/2-sizeTip.width/2);break;case"4":pointerObj.style.top=(sizeTip.height/2-15)+"px";a.top+=(b.height/2-sizeTip.height/2);a.left+=(b.width+(!isNoPointer&&12));break;case"87":pointerObj.style.left="13px";a.top+=(b.height+12);a.left-=26;break;case"89":pointerObj.style.right="13px";a.top+=(b.height+12);a.left-=(sizeTip.width-30);break;case"69":pointerObj.style.top="15px";a.top-=30;a.left-=(sizeTip.width+12);break;case"63":pointerObj.style.bottom="15px";a.top-=(sizeTip.height-30);a.left-=(sizeTip.width+12);break;case"23":pointerObj.style.right="14px";a.top-=(sizeTip.height+12);a.left-=(sizeTip.width-30);break;case"21":pointerObj.style.left="15px";a.top-=(sizeTip.height+12);a.left-=26;break;case"41":pointerObj.style.bottom="15px";a.top-=(sizeTip.height-30);a.left+=(b.width+12);break;case"47":pointerObj.style.top="15px";a.top-=30;a.left+=(b.width+12);break;case"5":var d=da(window),winWidth=parseInt(d.width(),10)||0,winHeight=parseInt(d.height(),10)||0;a={};a.top=(winHeight-sizeTip.height)/2;a.left=(winWidth-sizeTip.width)/2;break}return a},show:function(){this.tipObj.style.display="block";this.tipState="show";var a=da(this.tipTarget),posTarget=a.pos(),sizeTarget={width:a.width(),height:a.height()},posTip=this.getPos(posTarget,sizeTarget);this.pos(posTip);if(!this.tipSetting.close)this.tipCloseBt.style.display="none";if(this.tipSetting.warn.open)this.warn()},hide:function(){da(this.tipObj).css("display","none");this.tipState="hide";if(this.tipSetting.warn.open)this.warn(false)},pos:function(a){var b=da(this.tipObj);b.offset({left:a.left,top:a.top})},followMouse:function(a){var b={left:a.pageX,top:a.pageY};switch(this.tipSetting.pointer){case"87":case"89":b.top+=13;break;case"47":case"41":b.left+=13;break;case"69":case"63":b.left-=13;break;case"21":case"23":b.top-=13;break;case"5":b.top+=13;b.left+=13;break}this.pos(this.getPos(b))},color:function(a,b){if(undefined!==a)this.tipSetting.bg=a;if(undefined!==b)this.tipSetting.color=b;this.tipMidObj.style.background=this.tipSetting.bg;this.tipMidObj.style.color=this.tipSetting.color},warn:function(b){if(false===b&&this.warnTimer){clearTimeout(this.warnTimer);return}var c=this,fnShow=null,step=1;if(da.isFunction(b))this.tipSetting.warn.show=b;fnShow=this.tipSetting.warn.show;if(this.warnTimer)clearTimeout(this.warnTimer);this.warnTimer=setInterval(function(){if(fnShow)fnShow.call(c,step,c.tipMidObj);else{switch(step){case 1:case 3:var a=da(c.tipObj).pos();c.pos({left:a.left,top:a.top-5});c.color("#f17303");break;case 2:case 4:var a=da(c.tipObj).pos();c.pos({left:a.left,top:a.top+5});c.color("#d66500");break}}if(c.tipSetting.warn.length<++step)step=1},this.tipSetting.warn.delay)}};g.daTipCache={};g.cursor=function(b){var c=da(b.target),daTipObj=null;if(0==c.dom.length){alert("daTip温馨提示：跟随光标的tip,需要设置被提示DOM对象。");return}b.close=false;c.bind("mouseover",function(a){daTipObj=g(b);daTipObj.followMouse(a)}).bind("mousemove",function(a){if(daTipObj){daTipObj.followMouse(a)}}).bind("mouseout",function(a){if(daTipObj)daTipObj.hide()})};g.show=function(a){for(var b in g.daTipCache){if(a&&a!=g.daTipCache[b].tipSetting.group)continue;if("hide"==g.daTipCache[b].tipState)g.daTipCache[b].show()}};g.hide=function(a){for(var b in g.daTipCache){if(a&&a!=g.daTipCache[b].tipSetting.group)continue;if("show"==g.daTipCache[b].tipState)g.daTipCache[b].hide()}};g.fnStruct.init.prototype=g.prototype;e.daTip=e.datip=g})(window);(function(k,l){var m=k.document;var n=(function(){var j=function(a){return new j.fnStruct.init(a)};j.maxLevel={},j.fnStruct=j.prototype={version:"daPopMenu v1.0 \nauthor: danny.xu \ndate: 2011/7/3 22:33:14",menuId:"",menuTargetObj:null,menuObj:null,menuItems:null,menuSetting:{target:null,group:"popmenu",list:[],bg:"#f5f5f5",css:"daPopMenu",click:null,hover:null,out:null},menuLevel:0,defaultMenu:["-",["关于菜单..",function(a,b,c,d){alert(d.version)}]],init:function(a){a=this.menuSetting=da.extend(true,{},this.menuSetting,a);var b=da(a.target);if(0==b.dom.length){alert("daPopMenu温馨提示：弹出菜单需要提供一个目标对象");return}this.menuTargetObj=b.dom[0];a.list=a.list.concat(this.defaultMenu);var c=da.data(this.menuTargetObj,"popMenuParent");if(!c){this.menuId="popmenu"+da.nowId();j.maxLevel[this.menuId]=this.menuLevel}else{this.menuId=c.id;this.menuLevel=c.level+1;a.group=this.menuId+"_child_"+c.level;var d=j.maxLevel[this.menuId];j.maxLevel[this.menuId]=this.menuLevel>d?this.menuLevel:d}this.menuItems=[];this.create();this.bindEvent();if(0!==this.menuLevel)this.show()},create:function(){var h=this.menuSetting,menuList=h.list,itemHTML,fnClick,fnMouseOver,fnMouseOut,menuItems=this.menuItems,menuObj=m.createElement("div"),context=this,btObj;menuObj.className=h.css;for(var i=0,len=menuList.length;i<len;i++){if(da.isArray(menuList[i])){itemHTML=menuList[i][0];fnClick=menuList[i][1]?menuList[i][1]:h.click;fnMouseOver=menuList[i][2]?menuList[i][2]:h.hover;fnMouseOut=menuList[i][3]?menuList[i][3]:h.out}else{itemHTML=menuList[i];fnClick=h.click;fnMouseOver=h.hover;fnMouseOut=h.out}if("-"===itemHTML){btObj=m.createElement("hr")}else{btObj=m.createElement("a");btObj.href="javascript:void(0);";btObj.innerHTML=itemHTML;da.data(btObj,"popMenuParent",{id:this.menuId,level:this.menuLevel});(function(b,c,d,e,f,g){if(da.isFunction(d)){da(b).bind("click",function(a){d.call(b,context.menuTargetObj,g,c,context)})}if(da.isFunction(e)){da(b).bind("mouseover",function(a){e.call(b,context.menuTargetObj,g,c,context)})}if(da.isFunction(f)){da(b).bind("mouseout",function(a){f.call(b,context.menuTargetObj,g,c,context)})}})(btObj,itemHTML,fnClick,fnMouseOver,fnMouseOut,menuItems.length);menuItems.push(btObj)}menuObj.insertBefore(btObj,null)}this.menuObj=menuObj},bindEvent:function(){var b=this;if(0==this.menuLevel){da(this.menuTargetObj).bind("contextmenu",function(a){b.show().followMouse(a);return false});da(m).bind("click",function(a){b.hide()})}else{da(this.menuTargetObj).bind("mouseover",function(a){b.show()})}},hide:function(){var a=j.maxLevel[this.menuId];daTip.hide(this.menuSetting.group);for(var i=this.menuLevel,len=a;i<len;i++){daTip.hide(this.menuId+"_child_"+i)}},show:function(){var a={target:this.menuTargetObj,html:this.menuObj,group:this.menuSetting.group,bg:this.menuSetting.bg,close:false};if(0==this.menuLevel)a.pointer="no";this.hide();return daTip(a)}};j.fnStruct.init.prototype=j.prototype;j.hide=function(a){};return j})();k.daPopMenu=k.popmenu=n})(window);
