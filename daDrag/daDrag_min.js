/*
	author:	danny.xu
	date:	2010-11-10
	description:	daDrag类脚本文件
*/
(function(g){var h=g.document;var j=(function(){var f=function(a){return new f.fnStruct.init(a)};f.fnStruct=f.prototype={version:"daDrag 1.0  \n\nauthor: danny.xu\n\ndate: 2010-11-10\n\nThank you!!!",daDragSrc:null,daDragTarget:null,dragSetting:{window:g,src:null,target:null,before:null,move:null,after:null,cursor:"move"},daDraging:false,tagOldPos:{x:0,y:0},mouseStart:{x:0,y:0},mouseEnd:{x:0,y:0},init:function(a){this.dragSetting=a=da.extend(true,{},this.dragSetting,a);g=a.window;h=g.document;var b=a.src,objTarget=a.target;if("string"==typeof b){b=h.getElementById(b);if(null==b){alert("daTab提示:找不到可拖动对象。");return false}}this.daDragSrc=b;if("string"==typeof objTarget){objTarget=h.getElementById(objTarget);if(null==objTarget){return false}}this.daDragTarget=objTarget||this.daDragSrc;this.bind();return this},bind:function(){var e=this,fnBeforeDrag=this.dragSetting.before,fnMoveing=this.dragSetting.move,fnAfterDrag=this.dragSetting.after;da(this.daDragSrc).bind("mouseover",this.eventMouseOver=function(a){this.style.cursor=e.dragSetting.cursor}).bind("mouseout",this.eventMouseOut=function(a){this.style.cursor="default"});da(this.daDragSrc).bind("mousedown",this.eventMouseDown=function(a){if(g.captureEvents){g.captureEvents(a.MOUSEMOVE);a.stopPropagation();a.preventDefault()}else if(e.daDragSrc.setCapture)e.daDragSrc.setCapture();e.tagOldPos={x:parseInt(e.daDragTarget.offsetLeft),y:parseInt(e.daDragTarget.offsetTop)};e.daDragPStart={x:parseInt(a.clientX),y:parseInt(a.clientY)};e.daDraging=true;if(fnBeforeDrag)fnBeforeDrag.call(e,a,e.daDragSrc,e.daDragTarget)});da(h).bind("mousemove",this.eventMouseMove=function(a){if(e.daDraging){e.daDragPEnd={x:a.clientX,y:a.clientY};var b=e.daDragPEnd.x-e.daDragPStart.x;var c=e.daDragPEnd.y-e.daDragPStart.y;var d={x:e.tagOldPos.x+b,y:e.tagOldPos.y+c};if(fnMoveing)d=fnMoveing.call(e,a,e.daDragSrc,e.daDragTarget,e.tagOldPos,d,e.daDragPStart,e.daDragPEnd)||d;e.daDragTarget.style.left=("auto"==d.x?d.x:d.x+"px");e.daDragTarget.style.top=("auto"==d.y?d.y:d.y+"px");if(g.getSelection)g.getSelection().removeAllRanges();else if(h.getSelection)h.getSelection().removeAllRanges();else h.selection.empty()}}).bind("mouseup",this.eventMouseUp=function(a){if(e.daDraging){if(g.releaseEvents)g.releaseEvents(a.MOUSEMOVE);else if(e.daDragSrc.releaseCapture)e.daDragSrc.releaseCapture();e.daDraging=false;if(fnAfterDrag)fnAfterDrag.call(e,a,e.daDragSrc,e.daDragTarget)}});this.daDragSrc.daDragObj=this}};f.fnStruct.init.prototype=f.prototype;f.unbind=function(c){var d=da(c);if(0<d.dom.length){var e=da.browser.firefox?"DOMMouseScroll":"mousewheel";d.each(function(i,a){var b=this.daDragObj;if(b){da(this).unbind("mouseover",b.eventMouseOver).unbind("mouseout",b.eventMouseOut).unbind("mousedown",b.eventMouseDown);da(h).unbind("mousemove",b.eventMouseMove).unbind("mouseup",b.eventMouseUp);this.daDragObj=null}})}};return f})();g.daDrag=g.drag=j})(window);