/**daList
*基本信息列表类
* @author danny.xu
* @version daList_1.0 2011-11-25 16:16:29
*/
(function(g,j){var l=g.document;var m=(function(){var f=function(a){if(da.isFunction(a)||"string"===typeof a)return f.getList(a);return new f.fnStruct.init(a)};f.fnStruct=f.prototype={version:"daList v1.0 \n author: danny.xu \n date: 2011-11-25 16:16:32",lId:0,lObj:null,lTargetObj:null,lParentObj:null,daFrameObj:null,lItemObjs:null,lCurItem:null,width:0,height:0,setting:{parent:null,target:null,id:"",top:0,left:0,width:150,height:220,list:null,zIndex:1,css:{daList:"daList",shadow:"daShadow",item:"item",hover:"itemHover",selected:"item2"},click:null},init:function(a){a=this.setting=da.extend({},this.setting,a);var b=da(a.parent);this.lParentObj=0<b.dom.length?b.dom[0]:l.body;b=da(a.target);this.lTargetObj=0<b.dom.length?b.dom[0]:null;if(a.id)this.lId=a.id;else while(null!==l.getElementById("daList_"+this.lId))this.lId++;this.create();if(this.lTargetObj)this.setPos(this.lTargetObj);else this.setPos(a.top,a.left)},create:function(){var b=this,setting=this.setting,lObj;lObj=l.createElement("DIV");lObj.className=[setting.css.daList,setting.css.shadow].join(" ");lObj.style.zIndex=setting.zIndex;lObj.innerHTML='<div style="font-size:12px; font-weight:bold; padding:3px; color:#444">正在加载..</div>';da(lObj).width(80);this.width=80;this.height=22;da(lObj).bind("mousedown",function(a){a.stopPropagation()});this.lObj=lObj;this.lParentObj.insertBefore(lObj);if(this.setting.list)this.createList()},createList:function(){var a=this.setting,list=a.list,tmpCnt=l.createElement("div"),lItemObjs=[],objItem,itemWidth,itemHeight,w,h;this.lObj.innerHTML="";da(this.lObj).width(a.width);da(this.lObj).height(a.height);w=da(this.lObj).width();itemWidth=da.browser.ie?w-25:w-15;for(var k in list){objItem=l.createElement("a");objItem.className=a.css.item;objItem.href="javascript:void(0);";objItem.setAttribute("code",list[k]);da(objItem).width(itemWidth);objItem.innerHTML=k;this.itemBindEvent(objItem);tmpCnt.insertBefore(objItem);lItemObjs.push(objItem)}this.lItemObjs=lItemObjs;itemHeight=lItemObjs.length*26;h=parseInt(a.height);h=h<itemHeight?h:itemHeight;da(this.lObj).height(h);this.width=w;this.height=h;this.daFrameObj=daFrame({parent:this.lObj,html:tmpCnt,width:da.browser.ie?w-12:w-2,height:h,border:0});if(this.lTargetObj)this.setPos(this.lTargetObj);else this.setPos(a.top,a.left)},setList:function(a){if(!a||!da.isPlainObj(a))return;this.setting.list=a;this.createList();return this},setPos:function(a,b){if(a&&a.nodeType){var c=da(a),pos=c.offset(),oldDisplay=da(this.lObj).css("display");if("none"===oldDisplay)this.lObj.style.display="block";if(da.browser.ie){if(da(g).height()/2<pos.top)pos.top=pos.top-this.height+2;else pos.top=pos.top+c.height()-2;if(da(g).width()/2<pos.left)pos.left=pos.left-(this.width-c.width())+4;else pos.left-=5}else{if(da(g).height()/2<pos.top)pos.top=pos.top-this.height-2;else pos.top=pos.top+c.height()+1;if(da(g).width()/2<pos.left)pos.left=pos.left-(this.width-c.width())}this.setting.top=pos.top;this.setting.left=pos.left}else{this.setting.top=a||this.setting.top;this.setting.left=b||this.setting.left}da(this.lObj).css({top:this.setting.top,left:this.setting.left});da(this.lObj).css("display",oldDisplay)},itemBindEvent:function(b){var c=this;da(b).bind("click",function(a){c.select(this)}).bind("mouseover",function(a){if(c.setting.css.item===this.className)this.className=c.setting.css.hover}).bind("mouseout",function(a){if(c.setting.css.hover===this.className)this.className=c.setting.css.item})},select:function(a){var b=this.setting;code=a.getAttribute("code"),text=a.innerText||a.textContent;var c=this.text(text);if(da.isFunction(b.click)&&c)b.click.call(this,c)},next:function(){var a=this.lItemObjs,lCurItem=this.lCurItem;if(!a)return null;if(!lCurItem)return this.index(0);var b=lCurItem.index+1;if(a.length<=b){return this.index(0)}else{return this.index(b)}},prev:function(){var a=this.lItemObjs,lCurItem=this.lCurItem;if(!a)return null;if(!lCurItem)return this.index(a.length-1);var b=lCurItem.index-1;if(0>b){return this.index(a.length-1)}else{return this.index(b)}},show:function(){if("block"===this.lObj.style.display)return;if("undefined"===typeof daFx){this.lObj.style.display="block"}else{da(this.lObj).slideDown(300)}},hide:function(a){if("none"===this.lObj.style.display)return;if("undefined"===typeof daFx||a){this.lObj.style.display="none"}else{da(this.lObj).slideUp(150)}},release:function(){this.lObj=null;this.lTargetObj=null;this.lParentObj=null;for(var i=0,len=this.lItemObjs.length;i<len;i++){this.lItemObjs[i]=null}this.lItemObjs=null;this.lCurItem=null;this.setting.parent=null;this.setting.target=null;this.setting.list=null;this.setting.css=null;this.setting.click=null},remove:function(){if(this.daFrameObj){this.daFrameObj.remove();this.daFrameObj=null}da(this.lObj).remove();this.release()}};f.fnStruct.init.prototype=f.prototype;da.each(["value","text","index","get"],function(d,e){f.fnStruct[e]=function(a){var b=this,setting=this.setting,lItemObjs=this.lItemObjs;if(!lItemObjs)return null;if(j===a&&this.lCurItem){if("get"===e)return this.lCurItem;else return this.lCurItem[e]}var c=setting.list,lObj=this.lObj,lCurItem,item,itemCode,itemText;for(var i=0,len=lItemObjs.length;i<len;i++){item=lItemObjs[i];itemCode=item.getAttribute("code");itemText=item.innerHTML;if("index"===e&&i==a||"value"===e&&itemCode==a||"text"===e&&itemText==a){if(this.lCurItem)this.lCurItem.obj.className=setting.css.item;if(setting.css.selected!==item.className){item.className=setting.css.selected}lCurItem={index:i,value:itemCode,text:itemText,obj:item};this.daFrameObj.scroll((i-1)*26,0);break}}if(lCurItem){this.lCurItem=lCurItem;return lCurItem}else return null}});return f})();g.daList=m})(window);