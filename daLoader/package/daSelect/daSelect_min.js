/*
	author: danny.xu
	date:	2011-2-19
	discription: daSelect自定义下拉框
*/
(function(j,k){var l=j.document;var m=(function(){var g=function(a){if(da.isFunction(a)||"string"===typeof a)return g.getSelect(a);return new g.fnStruct.init(a)};g.fnStruct=g.prototype={sId:0,sObj:null,sParentObj:null,sBody:null,sContainerObj:null,sClientObj:null,sInput:null,sButtonObj:null,daListObj:null,setting:{parent:"",id:"",width:80,height:22,color:"#999,#666",listWidth:0,listHeight:220,tip:"请选择",icon:"",list:null,onlyOne:true,edit:false,off:false,zIndex:9999,css:{daSelect:"daButton",normal:"tb_daButton",focus:"tb_daButton2",input:"daSelectInput",button:"daSelectBt"},change:null},sArrColor:null,maxheight:100,version:"daSelect v1.0 danny.xu 2011-2-19",init:function(a){a=this.setting=da.extend({},this.setting,a);this.sParentObj=da(a.parent);this.sParentObj=0<this.sParentObj.dom.length?this.sParentObj.dom[0]:l.body;this.sArrColor=a.color.split(",");if(a.id)this.sId=a.id;else while(null!==l.getElementById("daSelect_"+this.sId))this.sId++;this.create();this.createList();this.reSize();this.bindEvent();g.pushCache(this)},create:function(){var a=this.setting,sId=this.sId,sObj,objInput,objButton;sObj=l.createElement("span");sObj.id=a.id?"daSelect_"+a.id:"daSelect_"+sId;sObj.className=a.css.daSelect;sObj.style.display="inline-block";sObj.innerHTML=['<table id="daSelectTable_',sId,'" class="tb_daButton" border="0" cellspacing="0" cellpadding="0">','<tr>','<td class="tl"></td>','<td class="top"></td>','<td class="tr"></td>','</tr>','<tr>','<td class="left"></td>','<td class="mid">','<div id="daSelectContainer_',sId,'" class="container" >','<div id="daSelectClient_',sId,'" class="client" >','</div>','</div>','</td>','<td class="right"></td>','</tr>','<tr>','<td class="bl"></td>','<td class="bottom"></td>','<td class="br"></td>','</tr>','</table>',].join("");this.sObj=sObj;this.sParentObj.insertBefore(sObj,null);this.sBody=l.getElementById("daSelectTable_"+sId);this.sContainerObj=l.getElementById("daSelectContainer_"+sId);this.sClientObj=l.getElementById("daSelectClient_"+sId);this.sClientObj.style.textAlign="left";this.sClientObj.style.padding=0;objInput=l.createElement("INPUT");objInput.type="text";objInput.value=a.tip;objInput.id=a.id||"daSelectInput_"+this.sId;objInput.className=a.css.input;this.sInput=objInput;this.sClientObj.insertBefore(objInput,null);if(!a.edit){objInput.setAttribute("readOnly",!a.edit);objInput.style.cursor="pointer"}else{objInput.style.borderWidth="1px";objInput.style.background="#f7f7f7"}if(a.off)objInput.disabled="disabled";objInput.setAttribute("code","");objButton=l.createElement("A");objButton.className=a.css.button;objButton.innerHTML=a.icon;this.sButtonObj=objButton;this.sClientObj.insertBefore(objButton,null)},createList:function(){var b=this,setting=this.setting;if(this.daListObj)this.daListObj.remove();this.daListObj=daList({target:this.sBody,list:setting.list,width:setting.listWidth||setting.width,height:setting.listHeight,click:function(a){b.value(a.value);b.hideList()}});this.reSize();this.hideList(true)},reSize:function(w,h){var a=this.setting;w=(w||a.width).toString();h=(h||a.height).toString();w=w.replace("px","");h=h.replace("px","");w=parseInt(w,10);h=parseInt(this.maxheight<a.height?this.maxheight:a.height,10);this.sObj.style.width=(w+4)+"px";this.sContainerObj.style.width=w+"px";this.sClientObj.style.width=w+"px";if(a.edit)this.sInput.style.width=(w-29)+"px";else this.sInput.style.width=(w-27)+"px";this.sObj.style.height=(h+4)+"px";this.sContainerObj.style.height=h+"px";this.sClientObj.style.height=h+"px";this.sInput.style.height=(h-2)+"px";if(a.onlyOne)this.sInput.style.lineHeight=h+"px";this.sButtonObj.style.height=h+"px";if(!this.daListObj)return;this.daListObj.setPos(this.sBody)},bindEvent:function(){var e=this;da(this.sObj).bind("mousedown",function(a){a.stopPropagation()});da(this.sButtonObj).bind("click",function(){e.showList()});da(this.sInput).bind("click",function(){e.showList()}).bind("change",function(){e.text(this.value)});if("undefined"===typeof daKey)return;daKey({target:this.sInput,keydown:function(a,b,c,d){if(!e.daListObj)return;if("Down Arrow"===a){e.showList();e.daListObj.next()}else if("Up Arrow"===a){e.showList();e.daListObj.prev()}else if("Enter"===a){e.value(e.daListObj.value());e.hideList()}}})},setList:function(a){if(!a||!da.isPlainObj(a))return;this.setting.list=a;this.createList();var b=this.sInput.getAttribute("code");if(b)this.value(b);else this.text(this.sInput.value);return this},get:function(){var a=this.sInput.value,txt=this.sInput.getAttribute("code");return{value:a,text:txt}},color:function(a){this.setting.color=a;this.sArrColor=a.split(",")},off:function(a){a=da.firstValue(a,false);this.setting.off=!!a;if(this.setting.off)this.sInput.disabled="disabled";else this.sInput.removeAttribute("disabled")},hide:function(){if("undefined"!==daFx)da(this.sObj).fadeOut(300);else this.sObj.style.display="none"},show:function(){if("undefined"!==daFx)da(this.sObj).fadeIn(300);else this.sObj.style.display="block"},change:function(a,b){try{if(this.setting.change)this.setting.change.call(this.sInput,a,b,this)}catch(e){}},showList:function(){if(this.setting.off)return;if(!this.daListObj)this.createList();this.daListObj.show();this.reSize();this.sBody.className=this.setting.css.focus;if("undefined"===typeof daFx){this.sListObj.style.display="block"}else{da(this.sListObj).slideDown(300)}if("undefined"===typeof daGif){this.sButtonObj.style.backgroundPositionX="-88px"}else{daGif({target:this.sButtonObj,all:5,speed:25,top:"50%",width:22,height:da(this.sButtonObj).height()})}},hideList:function(a){if(this.daListObj){this.daListObj.text(this.sInput.value);this.daListObj.hide(a)}if(this.setting.css.focus===this.sBody.className){this.sBody.className=this.setting.css.normal;if("undefined"===typeof daGif||a){this.sButtonObj.style.backgroundPositionX="0px"}else{daGif({target:this.sButtonObj,all:5,speed:10,top:"50%",width:22,height:da(this.sButtonObj).height(),isBack:true})}}}};da.each(["value","text"],function(d,e){g.fnStruct[e]=function(a){if("text"===e&&k===a)return this.sInput.value;if("value"===e&&k===a)return this.sInput.getAttribute("code");var b=this,sInput=this.sInput,setting=this.setting,oldText=sInput.value,oldValue=sInput.getAttribute("code");if("text"===e){sInput.value=a;sInput.setAttribute("code","")}if("value"===e){sInput.setAttribute("code",a);sInput.value=""}var c=this.daListObj[e](a);if(!c){c=this.daListObj.index(0)};sInput.value=c.text;sInput.setAttribute("code",c.value);if(oldText!==c.text||oldValue!==c.value){this.change(c.value,c.text)}return c}});g.fnStruct.init.prototype=g.prototype;g.hideList=function(a,b){if("string"===typeof b){b=g.getSelect(b);if(!b)return false}if(b&&b.hideList){b.hideList(a);return true}var c=g.daSelectCache;for(var i=0,len=c.length;i<len;i++){c[i].obj.hideList(a)}return true};g.toSelect=function(a){var b=da(a),daSelectObj,itemList,item,tip="",w=parseInt(b.css("width"),10),h=parseInt(b.css("height"),10),listWidth=parseInt(a.getAttribute("listWidth"),10),listHeight=parseInt(a.getAttribute("listHeight"),10),fnChange=a.getAttribute("change"),isOff=!!a.getAttribute("disabled"),isEdit=!!a.getAttribute("edit");if("INPUT"===a.tagName){tip=a.value;itemList={};var c=a.getAttribute("list");c=c.replace(/{|}/g,"");c=c.split(",");for(var i=0,len=c.length;i<len;i++){item=c[i].split(":");itemList[item[0]]=item[1]}}else if("SELECT"===a.tagName){var d=a.children;if(0<d.length){itemList={};da(d).each(function(){itemList[this.innerHTML]=this.value;if(this.selected)tip=this.innerHTML})}}try{fnChange=new Function(fnChange+'.apply( this, arguments);')}catch(e){fnChange=null;alert("daSelect温馨提示: "+a.id+"控件的change参数指定的回调函数名有误。")}var f={id:a.id,parent:a.parentNode,tip:tip,edit:isEdit,off:isOff,change:fnChange};if(w)f.width=w;if(h)f.height=h;if(itemList)f.list=itemList;if(listWidth)f.listWidth=listWidth;if(listHeight)f.listHeight=listHeight;daSelectObj=g(f);a.parentNode.replaceChild(daSelectObj.sObj,a)};g.daSelectCache=[];g.pushCache=function(a){var b=g.daSelectCache;b.push({id:a.sId,obj:a})};g.getSelect=function(c){var d=g.daSelectCache;if("string"===typeof c){c=c.replace("#","");for(var i=0,len=d.length;i<len;i++){if(c==d[i].id)return d[i].obj}return null}else if(da.isFunction(c)){da.each(d,function(a,b){return c.call(this.obj,this.id)});return d}};return g})();j.daSelect=m;da(l).bind("mousedown",function(a){m.hideList()})})(window);