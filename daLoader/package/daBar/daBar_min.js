/*
	author: danny.xu
	date: 	2011-5-9 13:45:03
	discription:	增强版按钮daBar	
*/
(function( win ){
var doc=win.document;var daBar=function(a){return new daBar.fnStruct.init(a)};daBar.fnStruct=daBar.prototype={version:"daBar 1.0 \n\nauthor: danny.xu\n\ndate: 2011-5-9 21:18:27\n\n Thanks!",barId:0,barObj:null,barParentObj:null,barColorObj:null,barBgObj:null,barTxtObj:null,barBtRightObj:null,barSetting:{parent:null,id:null,width:"100px",color:"#eee,#666",style:1,value:0,unit:"",min:0,max:100,css:{daBar:"daBar",daBarFocus:"daBar2",over:"daBarover",color:"daBarColor",bg:"daBarBg",txt:"daBarTxt",bt:"daBarBt"},drag:null},barArrColor:null,barNowValue:0,init:function(a){this.barSetting=a=da.extend(true,{},this.barSetting,a);if(a.id)this.barId=a.id;else while(null!==doc.getElementById("daBar_"+this.barId))this.barId++;this.barParentObj=doc.getElementById(a.parent)||doc.body;this.barArrColor=a.color.split(",");this.create();return this},create:function(){var a=this.barSetting,barObj=doc.createElement("div");barObj.className=this.barSetting.css.daBar;barObj.id=this.barSetting.id||"daBar_"+this.barId;barObj.innerHTML=['<div id="daBarOver_',this.barId,'" class="',a.css.over,'"></div>','<div id="daBarColor_',this.barId,'" class="',a.css.color,'"></div>','<div id="daBarBg_',this.barId,'" class="',a.css.bg,'" ></div>','<div id="daBarTxt_',this.barId,'" class="',a.css.txt,'" ></div>','<a id="daBarBtRight_',this.barId,'" class="',a.css.bt,'" href="javascript:void(0);"></a>'].join("");this.barObj=barObj;this.barParentObj.insertBefore(barObj,null);this.barColorObj=doc.getElementById("daBarColor_"+this.barId);this.barBgObj=doc.getElementById("daBarBg_"+this.barId);this.barTxtObj=doc.getElementById("daBarTxt_"+this.barId);this.barBtRightObj=doc.getElementById("daBarBtRight_"+this.barId);if(null===this.barSetting.drag)this.barBtRightObj.style.display="none";this.color(this.barSetting.color);this.size(this.barSetting.width);this.value(this.barSetting.value);this.bindEvent()},bindEvent:function(){var i=this.barSetting.drag,context=this;da(this.barObj).bind("mousedown",function(){context.focus()}).bind("mouseup",function(){context.blur()});if(null!==i){daDrag({src:this.barBtRightObj,target:this.barBtRightObj,cursor:"w-resize",move:function(a,b,c,d,e,f,g){var h=0,maxX=da(context.barObj).width()-6,nPercent;e.x=(e.x>maxX)?maxX:e.x;e.x=(e.x<h)?h:e.x;nPercent=parseInt(e.x/maxX*100,10);i.call(context,a,nPercent,parseInt(nPercent/100*context.barSetting.max,10));context.value(nPercent+"%");return{x:e.x,y:-3}}})}},setStopDefault:function(a){this.isStopDefault=da.isNull(a,false)},size:function(a){a=(a||this.barSetting.width).toString();a=a.replace("px","");this.barObj.style.width=a+"px";this.barTxtObj.style.left=(parseInt(a)+5)+"px"},value:function(a){if(undefined===a)return this.barNowValue;var b="number"===typeof a?parseInt(a/this.barSetting.max*100,10):(("string"===typeof a)&&(0<a.indexOf("%"))?parseInt(a.replace("%",""),10):parseInt(a,10));b=(0>b)?0:(100<b)?100:b;this.barNowValue=parseInt(b/100*this.barSetting.max,10);switch(this.barSetting.style){case 1:this.barTxtObj.innerHTML=['<span style="color:#C13100;font-weight:bold;">',b,'</span>%'].join("");break;case 2:this.barTxtObj.innerHTML=['<span style="color:#C13100;font-weight:bold;">',this.barNowValue,'</span>','&nbsp;',this.barSetting.unit,].join("");break;case 3:this.barTxtObj.innerHTML=['<span style="color:#C13100;font-weight:bold;">',this.barNowValue,'&nbsp;</span>',this.barSetting.unit,'&nbsp;/&nbsp;',this.barSetting.max,'&nbsp;',this.barSetting.unit].join("");break;case 4:this.barTxtObj.innerHTML=['<span style="color:#C13100;font-weight:bold;">',this.barNowValue,'&nbsp;</span>',this.barSetting.unit,'&nbsp;/&nbsp;',this.barSetting.max,'&nbsp;',this.barSetting.unit,'&nbsp;(<span style="color:#2C5700;font-weight:bold;">',b,'</span>%)&nbsp;'].join("");break}this.barColorObj.style.width=this.barBtRightObj.style.left=b+"%";this.barObj.style.marginRight=(da(this.barTxtObj).width()+20)+"px"},color:function(a){this.barSetting.color=a;this.barArrColor=a.split(",");this.barBgObj.style.backgroundColor=this.barArrColor[0]||"";this.barColorObj.style.backgroundColor=this.barArrColor[1]||""},blur:function(){this.barObj.className=this.barSetting.css.daBar},focus:function(){this.barObj.className=this.barSetting.css.daBarFocus}};daBar.fnStruct.init.prototype=daBar.prototype;win.daBar=daBar;
})(window);