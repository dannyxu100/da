/**daCanvas
*矢量图形绘制类
* @author danny.xu
* @version daCanvas_1.0 2011-10-31 17:31:23
*/
(function(e,f){var g=e.document,_SVG_NS="http://www.w3.org/2000/svg",_HasSVG=!!g.createElementNS&&!!g.createElementNS(_SVG_NS,'svg').createSVGRect;var h=(function(){var d=function(a){return new d.fnStruct.init(a)};d.fnStruct=d.prototype={version:"daCanvas v1.0 \n author: danny.xu \n date: 2011-10-31 17:31:26",draw:null,setting:{parent:null,click:null},curDrawing:"",curStep:"",curObj:null,init:function(a){a=this.setting=da.extend({},this.setting,a);if(_HasSVG)this.draw=daSVG(a);else this.draw=daVML(a);this.bindEvent()},resize:function(){this.draw.resize()},clear:function(){this.draw.clear()},bindEvent:function(){var b=this,mapObj=this.draw.daBoxObj.dom[0];da(mapObj).bind("click",function(a){b.click(a)});da(mapObj).bind("dblclick",function(a){b.dblclick(a)});da(mapObj).bind("mousedown",function(a){b.mousedown(a)});da(mapObj).bind("mouseup",function(a){b.mouseup(a)});da(mapObj).bind("mousemove",function(a){b.mousemove(a)});da(mapObj).bind("contextmenu",function(a){a.stopPropagation();a.preventDefault()})},mousedown:function(a){var b=this.draw.daBoxObj.dom[0],mX=a.pageX,mY=a.pageY,cvsOffSet=this.draw.daParentObj.offset(),X=mX-cvsOffSet.left,Y=mY-cvsOffSet.top;if(this.setting.click)this.setting.click(mX,mY,b,a)},mouseup:function(a){var b=this.draw.daBoxObj.dom[0],mX=a.pageX,mY=a.pageY,cvsOffSet=this.draw.daParentObj.offset(),X=mX-cvsOffSet.left,Y=mY-cvsOffSet.top;switch(this.curDrawing){case"POLYLINE":case"POLYGON":if(2===a.button){this.curStep="BEGIN";if(this.curObj["callback"]){this.curObj["callback"](false,{left:X,top:Y},{mouseX:mX,mouseY:mY});this.curObj["callback"](true,this.curObj)}}break}if(this.setting.click)this.setting.click(mX,mY,b,a)},mousemove:function(a){var b=this.draw.daBoxObj.dom[0],mX=a.pageX,mY=a.pageY,cvsOffSet=this.draw.daParentObj.offset(),X=mX-cvsOffSet.left,Y=mY-cvsOffSet.top;switch(this.curDrawing){case"LINE":if("FIRST_DOT"===this.curStep){this.curObj["line"].attr("to",X+","+Y)}break;case"POLYLINE":if("FIRST_DOT"===this.curStep){var c=this.curObj["points"];c[c.length-1]=X+","+Y;this.curObj["polyline"].attr("points",c.join(" "))}break;case"POLYGON":if("FIRST_DOT"===this.curStep){var c=this.curObj["points"];c[c.length-1]=X+","+Y;this.curObj["polygon"].attr("points",c.join(" "))}break}if(this.setting.mousemove)this.setting.mousemove(mX,mY,b,a)},click:function(a){var b=this.draw.daBoxObj.dom[0],mX=a.pageX,mY=a.pageY,cvsOffSet=this.draw.daParentObj.offset(),X=mX-cvsOffSet.left,Y=mY-cvsOffSet.top;switch(this.curDrawing){case"POINT":if("BEGIN"===this.curStep){this.curObj["circle"]=this.draw.circle({cx:X,cy:Y,r:3,borderWidth:2,fillColor:"#f00",opacity:0.6}).insert();this.curStep="FIRST_DOT";if(this.curObj["callback"]){this.curObj["callback"](false,{left:X,top:Y},{mouseX:mX,mouseY:mY});this.curObj["callback"](true,this.curObj)}}break;case"LINE":if("BEGIN"===this.curStep){this.curObj["circle"]=this.draw.circle({cx:X,cy:Y,r:3,borderWidth:2,fillColor:"#f00",opacity:0.6}).insert();this.curObj["line"]=this.draw.line({from:X+","+Y,to:X+","+Y,borderWidth:4,borderColor:"#f00",opacity:0.6}).insert();this.curStep="FIRST_DOT";if(this.curObj["callback"])this.curObj["callback"](false,{left:X,top:Y},{mouseX:mX,mouseY:mY})}else if("FIRST_DOT"===this.curStep){this.curObj["circle2"]=this.draw.circle({cx:X,cy:Y,r:3,borderWidth:2,fillColor:"#f00",opacity:0.6}).insert();this.curStep="BEGIN";if(this.curObj["callback"])this.curObj["callback"](true,this.curObj)}break;case"POLYLINE":if("BEGIN"===this.curStep){var c=[];c.push(X+","+Y);c.push(X+","+Y);this.curObj["points"]=c;this.curObj["polyline"]=this.draw.polyline({points:c.join(" "),borderWidth:2}).insert();this.curStep="FIRST_DOT"}else if("FIRST_DOT"===this.curStep){var c=this.curObj["points"];c.push(X+","+Y);this.curObj["polyline"].attr("points",c.join(" "))}if(this.curObj["callback"])this.curObj["callback"](false,{left:X,top:Y},{mouseX:mX,mouseY:mY});break;case"POLYGON":if("BEGIN"===this.curStep){var c=[];c.push(X+","+Y);c.push(X+","+Y);this.curObj["points"]=c;this.curObj["polygon"]=this.draw.polygon({points:c.join(" "),borderWidth:2,fillOpacity:0.1}).insert();this.curStep="FIRST_DOT"}else if("FIRST_DOT"===this.curStep){var c=this.curObj["points"];c.push(X+","+Y);this.curObj["polygon"].attr("points",c.join(" "))}if(this.curObj["callback"])this.curObj["callback"](false,{left:X,top:Y},{mouseX:mX,mouseY:mY});break}if(this.setting.click)this.setting.click(mX,mY,b,a)},dblclick:function(a){var b=this.draw.daBoxObj.dom[0],mX=a.pageX,mY=a.pageY,cvsOffSet=this.draw.daParentObj.offset(),X=mX-cvsOffSet.left,Y=mY-cvsOffSet.top;if(this.setting.dblclick)this.setting.dblclick(mX,mY,b,a)},stop:function(){this.curDrawing="";this.curStep="";this.curObj={}},point:function(a){this.curDrawing="POINT";this.curStep="BEGIN";this.curObj={"callback":a}},line:function(a){this.curDrawing="LINE";this.curStep="BEGIN";this.curObj={"callback":a,"circle":null,"line":null,"circle2":null}},polyline:function(a){this.curDrawing="POLYLINE";this.curStep="BEGIN";this.curObj={"callback":a,"points":[],"polygon":null}},polygon:function(a){this.curDrawing="POLYGON";this.curStep="BEGIN";this.curObj={"callback":a,"points":[],"polygon":null}}};d.fnStruct.init.prototype=d.prototype;return d})();e.daCanvas=h})(window);

/**daSVG
*矢量图形绘制支持类for W3C
* @author danny.xu
* @version daSVG_1.0 2011-10-31 17:31:23
*/
(function(g,i){var j=g.document,_SVG_NS="http://www.w3.org/2000/svg",_HasSVG=!!j.createElementNS&&!!j.createElementNS(_SVG_NS,'svg').createSVGRect;var k=(function(){var c=function(a){return new c.fnStruct.init(a)};c.fnStruct=c.prototype={daParentObj:null,daBoxObj:null,defs:null,setting:{parent:null,width:0,height:0,border:""},init:function(a){a=this.setting=da.extend({},this.setting,a);this.daParentObj=da(a.parent);if(0>=this.daParentObj.length){alert("daSVG温馨提示：没有找到daSVG画布的父节点对象。");return false}this.create();this.resize()},create:function(){var a=this.setting,map;map=this.createElement('svg').attr({xmlns:_SVG_NS,version:'1.1'});map.element.style.cssText="position:absolute; left:0px; top:0px; width:"+a.width+"px; height:"+a.height+"px;"+(this.setting.border?"border:"+this.setting.border:"");this.daParentObj.dom[0].insertBefore(map.element,null);this.daBoxObj=da(map.element);this.defs=this.createElement('defs').insert()},createElement:function(a){return l({parent:this,nodeName:a})},clear:function(){this.daBoxObj.empty();this.defs=this.createElement('defs').insert()},resize:function(w,h){var a=this.setting;w=w||a.width||this.daParentObj.width();h=h||a.height||this.daParentObj.height();this.daBoxObj.css({width:w,height:h})},text:function(a){this.resize();var b;return b},shape:function(a){this.resize();return this.createElement('path').attr({path:a.path,borderColor:"#222",borderWidth:1,fillColor:"#f00"})},line:function(a){this.resize();var b={from:"0,0",to:"0,0",borderColor:"#222",borderWidth:1};a=da.extend({},b,a);return this.createElement('line').attr(a)},rect:function(a){this.resize();var b={x:0,y:0,width:0,height:0,rx:0,ry:0,opacity:1,borderColor:"#222",borderWidth:1,borderOpacity:1,fillColor:'none',fillOpacity:1};a=da.extend({},b,a);return this.createElement('rect').attr(a)},polyline:function(a){this.resize();var b={points:"",opacity:1,borderColor:"#222",borderWidth:1,borderOpacity:1,fillColor:'none'};a=da.extend({},b,a);return this.createElement('polyline').attr(a)},polygon:function(a){this.resize();var b={points:"",opacity:1,borderColor:"#222",borderWidth:1,borderOpacity:1,fillColor:'#f00',fillOpacity:1};a=da.extend({},b,a);return this.createElement('polygon').attr(a)},circle:function(a){this.resize();var b={cx:0,cy:0,r:0,opacity:1,borderColor:"#222",borderWidth:1,borderOpacity:1,fillColor:'none',fillOpacity:1};a=da.extend({},b,a);return this.createElement('circle').attr(a)},ellipse:function(a){this.resize();var b={cx:0,cy:0,rx:0,ry:0,opacity:1,borderColor:"#222",borderWidth:1,borderOpacity:1,fillColor:'none',fillOpacity:1};a=da.extend({},b,a);return this.createElement('ellipse').attr(a)}};c.fnStruct.init.prototype=c.prototype;return c})();var l=(function(){var f=function(a){return new f.fnStruct.init(a)};f.fnStruct=f.prototype={map:null,element:null,setting:{parent:i,nodeName:"",attrSpecial:i},init:function(a){a=this.setting=da.extend({},this.setting,a);a.attrSpecial=a.attrSpecial||f.attrSpecial;this.create()},create:function(){this.element=j.createElementNS(_SVG_NS,this.setting.nodeName);this.map=this.setting.parent},attr:function(a,b){var c=this.setting,element=this.element,key,value;if("string"===typeof a){if(i===b){a=f.reviseAttr(a);return da.attr(element,a[0])}key=a;a={};a[key]=b}a=f.reviseAttr(a);for(key in a){value=a[key];var d=c.attrSpecial&&c.attrSpecial[key]&&c.attrSpecial[key].call(this,value);if(false!==d){if(i!==d)value=d;da.attr(element,key,value)}}return this},insert:function(a){var b=this.map,element=this.element,daBoxObj=b.daBoxObj,parentNode=a?a.element||a:daBoxObj.dom[0];try{parentNode.insertBefore(element)}catch(e){}return this}};f.fnStruct.init.prototype=f.prototype;f.attrSpecial={};da.each(["from","to"],function(c,d){f.attrSpecial[d]=function(a){var b=a.split(",");if("from"===d)this.attr({x1:b[0],y1:b[1]});else this.attr({x2:b[0],y2:b[1]});return false}});f.attrHash={};f.attrHash["shape"]={xmlns:["xmlns",_SVG_NS],version:["version","1.1"],borderColor:["stroke","#222"],borderWidth:["stroke-width","1"],borderOpacity:["stroke-opacity",1],fillColor:["fill","none"],fillOpacity:["fill-opacity",1],opacity:["opacity",1],path:["d","m0,0 l e"],x:["x",0],y:["y",0],width:["width",0],height:["height",0],from:["from","0,0"],to:["to","0,0"],x1:["x1",0],y1:["y1",0],x2:["x2",0],y2:["y2",0],cx:["cx",0],cy:["cy",0],r:["r",0],rx:["rx",0],ry:["ry",0],points:["points","0,0"]};f.reviseAttr=function(a,b){var c=f.attrHash["shape"],p=a,res={},key,obj;if("string"===typeof p){return c[p]}else{for(key in p){obj=c[key];if(obj)res[obj[0]]=da.firstValue(p[key],obj[1])}}return res};return f})();g.daSVGElement=l;g.daSVG=k})(window);

/**daVML
*矢量图形绘制支持类forIE
* @author danny.xu
* @version daVML_1.0 2011-10-31 17:31:23
*/
(function(g,j){var k=g.document,_IsIE8=navigator.userAgent.indexOf('MSIE 8.0')>-1,_DocMode8=k.documentMode===8,_Math=Math,_MathRound=_Math.round,_MathFloor=_Math.floor,_MathCeil=_Math.ceil,_MathMax=_Math.max,_MathMin=_Math.min,_MathAbs=_Math.abs,_MathCos=_Math.cos,_MathSin=_Math.sin,_MathPI=_Math.PI,_Deg2Rad=_MathPI*2/360,_PixelScale=1;var l=(function(){var c=function(a){return new c.fnStruct.init(a)};c.fnStruct=c.prototype={daParentObj:null,daBoxObj:null,setting:{parent:null,width:0,height:0,border:""},init:function(a){a=this.setting=da.extend({},this.setting,a);this.daParentObj=da(a.parent);if(0>=this.daParentObj.length){alert("daVML温馨提示：没有找到daVML画布的父节点对象。");return false}k.createStyleSheet().addRule(".daVML","behavior:url(#default#VML); display: inline-block;");try{if(!k.namespaces.daVML)k.namespaces.add('daVML','urn:schemas-microsoft-com:vml')}catch(e){};this.create();this.resize()},create:function(){var a=k.createElement("div");a.style.cssText="position:absolute; left:0px; top:0px; width:10px; height:10px; overflow:hidden;"+(this.setting.border?"border:"+this.setting.border:"");this.daParentObj.dom[0].insertBefore(a,null);this.daBoxObj=da(a)},createElement:function(a,b){return m({parent:this,nodeName:a,is2Level:b})},clear:function(){this.daBoxObj.empty()},resize:function(w,h){var a=this.setting;w=w||a.width||this.daParentObj.width();h=h||a.height||this.daParentObj.height();this.daBoxObj.css({width:w,height:h})},childElem:function(a,b){return this.createElement(a,true).attr(b)},text:function(a){this.resize();var b,defaultParams={text:"",left:0,top:0,fontFamily:'"Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif',fontSize:'12px'};a=da.extend({},defaultParams,a);b=k.createElement("span");b.style.cssText=" position:absolute; left:0px; top:0px;";da(b).css({whiteSpace:'nowrap',left:_MathRound(a.top),top:_MathRound(a.top),fontFamily:a.fontFamily,fontSize:a.fontSize});b.innerHTML=a.text;return b},setScale:function(a,b){if(!a.element)return;da(a.element).css({top:b.y||b.top||0,left:b.x||b.left||0,width:b.width||_PixelScale,height:b.height||_PixelScale})},shape:function(a){this.resize();var b=this.createElement('shape'),def={path:"m0,0 l e",size:"1,1",borderColor:"#222",borderWidth:1,fill:true,fillColor:"#f00"};a=da.extend({},def,a);this.setScale(b,a);return b.attr(a)},line:function(a){this.resize();var b=this.createElement('line'),def={from:"0,0",to:"0,0",borderColor:"#222",borderWidth:1};a=da.extend({},def,a);this.setScale(b,a);return b.attr(a)},rect:function(a){this.resize();var b=this.createElement((j!=a.rx||j!=a.ry)?"roundRect":"rect"),def={width:0,height:0,rx:0,ry:0,borderColor:"#222",borderWidth:1,fill:a.fillColor?true:false};a=da.extend({},def,a);this.setScale(b,a);return b.attr(a)},polyline:function(a){this.resize();var b=this.createElement("polyline"),def={points:"0,0",borderColor:"#222",borderWidth:1,fill:a.fillColor?true:false};a=da.extend({},def,a);this.setScale(b,a);return b.attr(a)},polygon:function(a){this.resize();var b={points:"0,0",fillColor:"#f00"};a=da.extend({},b,a);return this.shape(a)},circle:function(a){this.resize();var b=this.createElement("oval"),def={left:parseInt(a.cx)-parseInt(a.r),top:parseInt(a.cy)-parseInt(a.r),width:parseInt(a.r)*2,height:parseInt(a.r)*2,borderColor:"#222",borderWidth:1,fill:a.fillColor?true:false};a=da.extend({},def,a);this.setScale(b,a);return b.attr(a)},ellipse:function(a){this.resize();var b=this.createElement("oval"),def={left:parseInt(a.cx)-parseInt(a.rx),top:parseInt(a.cy)-parseInt(a.ry),width:parseInt(a.rx)*2,height:parseInt(a.ry)*2,borderColor:"#222",borderWidth:1,fill:a.fillColor?true:false};a=da.extend({},def,a);this.setScale(b,a);return b.attr(a)}};c.fnStruct.init.prototype=c.prototype;return c})();var m=(function(){var f=function(a){return new f.fnStruct.init(a)};f.fnStruct=f.prototype={map:null,element:null,setting:{parent:j,nodeName:"",width:_PixelScale,height:_PixelScale,is2Level:false,attrSpecial:j},init:function(a){a=this.setting=da.extend({},this.setting,a);a.attrSpecial=a.attrSpecial||f.attrSpecial;this.create()},create:function(){var a=this.setting,element=[a.nodeName,' class="daVML" '],style="position:absolute; left:0px; top:0px; width:"+a.width+"px; height:"+a.height+"px;";this.map=a.parent;if(!a.is2Level){element.push(' filled="true" stroked="true" ');element.push(' style="');element.push(style);element.push('" ')}if(_IsIE8){element.unshift('<');element.push(' xmlns="urn:schemas-microsoft-com:vml" />')}else{element.unshift('<daVML:');element.push('/>')}this.element=k.createElement(element.join(""))},attr:function(a,b){var c=this.setting,level2=(c.is2Level?c.nodeName:false),element=this.element||{},key,value;if("string"===typeof a){if(j===b){a=f.reviseAttr(a,level2);if(_DocMode8){return element[a[0]]}else{return da.attr(element,a[0])}}key=a;a={};a[key]=b}a=f.reviseAttr(a,level2);for(key in a){value=a[key];var d=c.attrSpecial&&c.attrSpecial[key]&&c.attrSpecial[key].call(this,value);if(false!==d){if(j!==d)value=d;if(_DocMode8){try{if("undefined"!=typeof element[key]&&"undefined"!=typeof element[key].value)element[key].value=value;else element[key]=value}catch(e){debugger}}else{da.attr(element,key,value)}}}return this},insert:function(a){var b=this.map,element=this.element,daBoxObj=b.daBoxObj,parentNode=a?a.element||a:daBoxObj.dom[0];try{parentNode.insertBefore(element)}catch(e){}return this}};f.fnStruct.init.prototype=f.prototype;f.attrSpecial={};f.attrSpecial["fillOpacity"]=function(a){if(this.setting.is2Level)return;this.map.childElem("fill",{opacity:a}).insert(this.element);return false};f.attrSpecial["borderOpacity"]=function(a){if(this.setting.is2Level)return;this.map.childElem("stroke",{opacity:a}).insert(this.element);return false};f.attrSpecial["opacity"]=function(a){if(this.setting.is2Level)return;this.setting.attrSpecial["fillOpacity"].call(this,a);this.setting.attrSpecial["borderOpacity"].call(this,a);return false};f.attrSpecial["points"]=function(a){if("shape"===this.setting.nodeName){var b=a.split(" "),arrPath=[];for(var i=0,len=b.length;i<len;i++){if(0===i){arrPath.push('m')}else if(1===i){arrPath.push(' l')}arrPath.push(b[i]+' ')}arrPath.push(b[0]+' ');arrPath.push(' xe');this.attr("path",arrPath.join(''));return false}return a};f.attrHash={};f.attrHash["shape"]={size:["coordsize",(_PixelScale+","+_PixelScale)],origin:["coordorigin","0,0"],wrap:["wrapcoords",null],border:["stroked","true"],opacity:["opacity",1],borderColor:["strokecolor","#333"],borderWidth:["strokeweight","1px"],fill:["filled","true"],fillColor:["fillcolor","none"],borderOpacity:["borderOpacity",1],fillOpacity:["fillOpacity",1],path:["path","m0,0 l e"],type:["type",null],from:["from","0,0"],to:["to","0,0"],x:["left",0],y:["top",0],arc:["arcsize",0.05],points:["points","0,0"],startAngle:["startangle",-180],endAngle:["endangle",null],curve1:["control1",null],curve2:["control2",null]};f.attrHash["stroke"]={on:["on","true"],opacity:["opacity",1],color:["color","black"],type:["filltype","solid"],width:["weight","1px"],style:["dashstyle","solid"],src:["src",null],imageSize:["imagesize","auto"],imageAlign:["imagealignshape","true"],imageColor:["color2",null],arrow1:["startarrow","none"],arrow2:["endarrow","none"],arrow1Width:["startarrowwidth","medium"],arrow1Length:["startarrowlength","medium"],arrow2Width:["endarrowwidth","medium"],arrow2Length:["endarrowlength","medium"],joint:["miterlimit",8],joinstyle:["joinstyle","round"],endcap:["joinstyle","round"]};f.attrHash["fill"]={on:["on","true"],opacity:["opacity",1],type:["type","solid"],color:["color","black"],color2:["color2","white"],colors:["colors",null],angle:["angle",0],offset:["focus","0%"],focussize:["focussize","0,0"],focusposition:["focusposition","0,0"],method:["method","sigma"],src:["src",null],imageSize:["size","auto"],imageOffset:["position","auto"],origin:["origin","auto"],aspect:["aspect","ignore"],alignshape:["alignshape","true"]};f.attrHash["shadow"]={on:["on","true"],opacity:["opacity",1],type:["type","single"],color:["color","black"],color2:["color2","gray"],offset:["offset","2px,2px"],offset2:["offset2","2px,2px"],obscured:["obscured","false"],origin:["origin","0,0"],matrix:["matrix",null]};f.reviseAttr=function(a,b){var c=(b?f.attrHash[b]:f.attrHash["shape"]),p=a,res={},key,obj;if("string"===typeof p){return c[p]}else{for(key in p){obj=c[key];if(obj)res[obj[0]]=da.firstValue(p[key],obj[1])}}return res};return f})();g.daVMLElement=m;g.daVML=l})(window);